<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<c:set var="cartList" value="${dataMap.cartList }" />
<c:set var="bookList" value="${dataMap.bookList }" />
<c:set var="rentList" value="${dataMap.rentList }" />
<c:set var="pageMaker" value="${dataMap.pageMaker }" />
<c:set var="cri" value="${pageMaker.cri }" />
<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0,minimal-ui">
    <meta name="description" content="Vuexy admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Vuexy admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>Checkout - Vuexy - Bootstrap HTML admin template</title>
    <link rel="apple-touch-icon" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/images/ico/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500;1,600" rel="stylesheet">

    <!-- BEGIN: Vendor CSS-->
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/forms/wizard/bs-stepper.min.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/forms/spinner/jquery.bootstrap-touchspin.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/extensions/toastr.min.css">
    <!-- END: Vendor CSS-->

    <!-- BEGIN: Theme CSS-->
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/bootstrap-extended.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/colors.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/components.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/dark-layout.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/bordered-layout.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/semi-dark-layout.css">

    <!-- BEGIN: Page CSS-->
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/core/menu/menu-types/horizontal-menu.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/pages/app-ecommerce.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/plugins/forms/pickers/form-pickadate.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/plugins/forms/form-wizard.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/plugins/extensions/ext-component-toastr.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/plugins/forms/form-number-input.css">
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/pages/page-knowledge-base.css">

    <!-- END: Page CSS-->

    <!-- BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/assets/css/style.css">
<%-- 	<link rel="stylesheet" href="<%=request.getContextPath()%>/resources/css/button.css"> --%>
    <!-- END: Custom CSS-->

</head>
<!-- END: Head-->

<style>
table {
	font-size:11px;
	border-collapse: separate;
 	border-spacing: 0px;
/*      border-collapse: collapse; */
     width: 90%;
     table-layout: fixed
}
 th, td {
     padding: 10px;
     border-bottom: 1px solid #edf5ff;
}
/* tr:hover { background-color: #F5F5F5; } */

td {
text-overflow:ellipsis; 
overflow:hidden; 
white-space:nowrap;

}
.hei{
	height:30%;
	margin-top:10px;
}
</style>

<!-- BEGIN: Body-->

<body class="horizontal-layout horizontal-menu  navbar-floating footer-static  " data-open="hover" data-menu="horizontal-menu" data-col="">
             <c:if test="${!empty cartList }">

      <div class="container">
      
	<!--       페이지처리를 위해 필요한 기본값. 보이지 않게 저장해놓은것. -->
      	<select class="form-control col-md-3" name="perPageNum" id="perPageNum" style="display: none;">
  			<option value="10" >정렬개수</option>
		</select>
		<select class="form-control form-select" name="searchType" id="searchType" style="display: none;">
			<option value="t">제목</option>	
		</select>
		
            <div class="content-header row">
                <div class="content-header-left col-md-9 col-12 mb-2">
                    <div class="row breadcrumbs-top">
                        <div class="col-12">
                            <h2 class="content-header-title mb-0">도서 장바구니</h2><br>
                            <h3 class="content-header-title mb-0">도서를 선택하고, 원하는 예약방법을 클릭하세요</h3>
                        </div>
                    </div>
                </div>

            </div>
            
            
    <!-- BEGIN: Content-->
    <div class=" content ecommerce-application">
    
    
        <div class="content-wrapper container-xxl p-0">
            <div class="content-body">
                <div class="bs-stepper checkout-tab-steps">
                
                <div class="card" style="padding-bottom: 40px;padding-top: 20px; text-align: center;">
                	<div class="row justify-content-center">
           	    		<div class="col-4  row align-items-center">
	                			<div class="col-12 ">
	                				<input type="hidden" id="canRent" value="${5 - rentList.size()}">
	                				<c:forEach items="${rentList}" var="rent">
		                				<input type="hidden" id="rentIsbn" value="${rent.isbn}">
	                				</c:forEach>
	        	        			<h2>현재 대출 권수 : ${rentList.size()} 권</h2>
	                			</div>
    							<div class="col-12 ">
	    	            			<h2>대출 가능 권수 : ${5 - rentList.size()} 권</h2>
	    	            			<small>* 대출불가도서는 예약에서 제외됩니다.</small>
    							</div>
	               		</div>
                		<div class="col-2" >
                			<button onclick="goReserve('field');" class="btn">
			              	   <img src="<%=request.getContextPath()%>/resources/img/re.png"  style="width: 150px; border: 2px solid #7367f0; border-radius: 30%;">
                			</button>
                		</div>
						<div class="col-2" >
							<button onclick="goReserve('locker');" class="btn">
			              	   <img src="<%=request.getContextPath()%>/resources/img/sa.png"  style="width: 150px; border: 2px solid #7367f0; border-radius: 30%;">
							</button>
						</div>
						<div class="col-2" >
							<button onclick="goReserve('drive');" class="btn">
			              	   <img src="<%=request.getContextPath()%>/resources/img/dr.png"  style="width: 150px; border: 2px solid #7367f0; border-radius: 30%;">
							</button>
						</div>
						<div class="col-2" >
							<button onclick="goReserve('delivery');" class="btn">
			              	   <img src="<%=request.getContextPath()%>/resources/img/po.png"  style="width: 150px; border: 2px solid #7367f0; border-radius: 30%;">
							</button>
						</div>
                	</div>
				</div>
                    <!-- Wizard starts -->
                    <div class="bs-stepper-header" style=" padding-left: 120px;">
                        <div class="step" data-target="#step-cart" role="tab" id="step-cart-trigger">
                            <button type="button" class="step-trigger" >
                                <span class="bs-stepper-box">
                                    <i data-feather="shopping-cart" class="font-medium-3"></i>
                                </span>
                                <span class="bs-stepper-label">
                                    <span class="bs-stepper-title" onclick="deleteCart()">선택 도서 삭제</span>
                                </span>
                            </button>
                            
                             <button type="button" class="step-trigger" style="padding-left: 30px;">
                                <span class="bs-stepper-box">
                                    <i data-feather="shopping-cart" class="font-medium-3"></i>
                                </span>
                                <span class="bs-stepper-label">
                                    <span class="bs-stepper-title" id="cbx_chkAll" onclick ="checkBoxAll()">모든 도서 선택</span>
                                </span>
                            </button>
                        </div>
                    </div>
                    
                    
                    <!-- Wizard ends -->
                  
                          
                    
                    <div class="bs-stepper-content">
                            
                        <!-- Checkout Place order starts -->
                        <div id="step-cart" class="content" role="tabpanel" aria-labelledby="step-cart-trigger">
                            <div id="place-order" class="list-view product-checkout">
                               <form action ="<%=request.getContextPath()%>/main/myInfo/bookCart/delete.do" method="get" role="checkForm">
                               	<input type="hidden" name="mem_id" id="mem_id" value="${!empty loginUser.mem_id ? loginUser.mem_id : 'aa'}">
                                  <div id="searchResult" style="width: 1200px; margin:0 auto; ">
                                  	<c:forEach items="${bookList }" var="book">
	                         			<div class="checkout-items" id="bookListDiv">                              
						                  <div class="card ecommerce-card" >
						                      <div class="item-img" style="width: 200px;">
						                      		<div class="form-check form-check-warning" style="padding-right: 20px;">
						                      			<input type="checkbox" class="form-check-input" name= "checkedValue" id="checkedValue" value ="${book.book_isbn}" title="${book.book_title}">
						                      		</div>
						                            <img src="${book.book_imgURL}" style="width: 100px;"/>
						                      </div>
						                      <div class="card-body" style="padding-top: 0px;">
						                          <div class="item-name" style=" width: 700px;">
						                              <h4 class="mb-0"><a href="app-ecommerce-details.html" class="text-body" style="margin-bottom: 25px; margin-top: 10px;">${book.book_title}</a></h4>
						                            
						                              <span class="item-company">도서명 <a href="#" class="company-name">${book.book_title}</a></span><br>
						                              <span class="item-company">저자 <a href="#" class="company-name">${book.book_author}</a></span><br>
						                              <span class="item-company">출판사 <a href="#" class="company-name">${book.book_publisher}</a></span>
						                              <span class="item-company">발행연도 <a href="#" class="company-name">${book.book_publishDate}</a></span><br>
						                              <span class="item-company">도서 위치  <a href="#" class="company-name">3층 어린이도서 329</a></span>
						                            
						                              <div class="item-rating">
						                                  <ul class="unstyled-list list-inline">
						                                      <li class="ratings-list-item"><i data-feather="star" class="filled-star"></i></li>
						                                      <li class="ratings-list-item"><i data-feather="star" class="filled-star"></i></li>
						                                      <li class="ratings-list-item"><i data-feather="star" class="filled-star"></i></li>
						                                      <li class="ratings-list-item"><i data-feather="star" class="filled-star"></i></li>
						                                      <li class="ratings-list-item"><i data-feather="star" class="unfilled-star"></i></li>
						                                  </ul>
						                              </div>
						                          </div>
						                      </div>
						                      <div class="item-options text-center">
						                          <div class="item-wrapper">
						                              <div class="item-cost">
						                               
													 <table style="text-align: center;">
						                              		<tr>
						                              		 <th width="50%">도서 번호</th>
						                              		 <th width="50%">상태</th>
						                              		</tr>
						                              	<c:forEach items="${book.sameBookList }" var="samebook">
						                              	
				                                        	<tr>
				                                        			<td>${samebook.book_no}</td>
							                                     	<td> 
							                                     		<c:choose>
			                                        						 <c:when test="${samebook.state_code eq 1 or samebook.state_code eq 5 }"> 대출 가능 </c:when>
			                                        					 	 <c:otherwise> 대출 불가능</c:otherwise>
			                                     						 </c:choose>
							                                     	</td>
				                                        	</tr>
                                        				</c:forEach>
													</table>
						                              </div>
						                          </div>
						                      </div>
						                  </div>       
						          		</div>
					          		</c:forEach>
					          		
                   			      </div>
			          		  </form>
                               
                               
                            
                            <!-- Checkout Place order Ends -->
                        </div>
                        
                        <div class="card-footer">
						  <%@ include file="/WEB-INF/views/include/bookpagination.jsp"%>
						</div>
                        
                <div class="card" style="padding-bottom: 40px;padding-top: 20px; text-align: center;">
                	<div class="row justify-content-center">
                		<div class="col-2" onclick="">
		              	   <img src="<%=request.getContextPath()%>/resources/img/re.png"  style="width: 150px; border: 2px solid #7367f0; border-radius: 30%;">
                		</div>
						<div class="col-2">
		              	   <img src="<%=request.getContextPath()%>/resources/img/sa.png"  style="width: 150px; border: 2px solid #7367f0; border-radius: 30%;">
						</div>
						<div class="col-2">
		              	   <img src="<%=request.getContextPath()%>/resources/img/dr.png"  style="width: 150px; border: 2px solid #7367f0; border-radius: 30%;">
						</div>
						<div class="col-2">
		              	   <img src="<%=request.getContextPath()%>/resources/img/po.png"  style="width: 150px; border: 2px solid #7367f0; border-radius: 30%;">
						</div>
                	</div>
				</div>
                        
                        
                        
                   
                        <!-- Checkout Customer Address Starts -->
                        <div id="step-address" class="content" role="tabpanel" aria-labelledby="step-address-trigger">
                        </div>
                        <!-- Checkout Customer Address Ends -->
                        <!-- Checkout Payment Starts -->
                        <div id="step-payment" class="content" role="tabpanel" aria-labelledby="step-payment-trigger">
                        </div>
                        <!-- Checkout Payment Ends -->
                   </div>
                </div>
            </div>
          </div>
        </div>
      </div>
</div>
                   	</c:if>	    
                   	 <c:if test="${empty cartList }">
                                     <div class="card-body" style="padding-top: 0px; padding-bottom: 0px;">
                            <div class="mt-4 mb-2 text-center">
                                <h4>도서 예약방법</h4> 
                                <p class="card-text">Process of how to reserve books </p>
                            </div>
	                        </div>     
			                <div style="text-align: center;">
			                    <img src="<%=request.getContextPath()%>/resources/images/process.png"  style="width: 1000px; ">
			                </div>
		                      	<div  style="text-align: center; ">>
							<img src="<%=request.getContextPath()%>/resources/img/empty.jpg"  style="width: 700px;  ">
                      		</div>
                   	</c:if>
                   	
<form id="reserveForm">	
	<input type='hidden' name="isbn" value="" />
	<input type='hidden' name="mem_id" value="" />
</form>
    <!-- END: Content-->
    <!-- BEGIN: Vendor JS-->
    <script src="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/vendors.min.js"></script>    <!-- BEGIN Vendor JS-->

    <!-- BEGIN: Page Vendor JS-->
    <script src="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/ui/jquery.sticky.js"></script>
    <script src="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/forms/wizard/bs-stepper.min.js"></script>
    <script src="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/forms/spinner/jquery.bootstrap-touchspin.js"></script>
    <script src="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/extensions/toastr.min.js"></script>
    <!-- END: Page Vendor JS-->

    <!-- BEGIN: Theme JS-->
    <script src="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/core/app-menu.js"></script>
    <script src="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/core/app.js"></script>
    <!-- END: Theme JS-->

    <!-- BEGIN: Page JS-->
    <script src="<%=request.getContextPath()%>/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/scripts/pages/app-ecommerce-checkout.js"></script>
    <!-- END: Page JS-->
    <script	src="<%=request.getContextPath()%>/resources/jquery/jquery.min.js"></script>
    <script src="<%=request.getContextPath()%>/resources/js/common.js"></script>
	<%@ include file="../../../common/index_js.jsp" %>
	
   	<script>
       $(window).on('load', function() {
           if (feather) {
               feather.replace({
                   width: 14,
                   height: 14
               });
           }
       })
   </script>
   <script>
   function goReserve(type){
	   var url = ""

	   
	   if(type == 'field'){
		   url = "<%=request.getContextPath()%>/main/myInfo/fieldReserve.do";
	   }else if(type == 'locker'){
		   url = "<%=request.getContextPath()%>/main/myInfo/lockerReserve.do";
	   }else if(type == 'drive'){
		   url = "<%=request.getContextPath()%>/main/myInfo/driveReserve.do";
	   }else if(type == 'delivery'){
		   url = "<%=request.getContextPath()%>/main/myInfo/deliveryReserve.do";
	   }
	   
	   var canRent = $('#canRent').val();
	   console.log(canRent);
	   
	   var rentBook = document.querySelectorAll('#rentIsbn');
	   var checkedBook = document.querySelectorAll('input[name="checkedValue"]:checked');
	   var cob_check = checkedBook.length;
	   var isbnList = [];
	   for(var i = 0; i < cob_check; i++){
		   console.log(checkedBook);
		   isbnList[i] = checkedBook[i].defaultValue;
	   }
	   for(var i=0; i< cob_check; i++){
		   for(var j=0; j<rentBook.length; j++){
			   if(checkedBook[i].defaultValue == rentBook[j].defaultValue){
				   alert("["+checkedBook[i].title + "]은 이미 대출중입니다.");
				   return false;
			   }
		   }
	   }
	   console.log(isbnList);
	
	   if(cob_check == 0) {
		      alert('선택된 도서가 없습니다');
		      return false;
		  }
	   
	   if(cob_check > canRent){
		   alert("최대 " + canRent + "권 대출 가능합니다.");
		   return false;
	   }
	   
	   var reserveForm = $('#reserveForm');
	   reserveForm.find("[name='isbn']").val(isbnList);
	   reserveForm.find("[name='mem_id']").val($('[name="mem_id"]').val());
	   reserveForm.attr({
			action : url,
			method : 'get'
		}).submit();
   }
   
   </script>
   <script>
    function list_go(page, url){
    	   if(!url) url="<%=request.getContextPath()%>/main/myInfo/bookCart.do";
    				var jobForm = $('#jobForm');
    				jobForm.find("[name='page']").val(page);jobForm
    				jobForm.find("[name='perPageNum']").val(
    						$('select[name="perPageNum"]').val());
    				jobForm.find("[name='searchType']").val(
    						$('select[name="searchType"]').val());
    				jobForm.find("[name='keyword']").val(
    						$('div.input-group>input[name="keyword"]').val());
    				jobForm.attr({
    					action : url,
    					method : 'get'
    				}).submit();
    			}
    </script>
    
     <script>
	function search_go(page,url) {
		if(!url) url="<%=request.getContextPath()%>/main/myInfo/bookCart.do";
				var jobForm = $('#jobForm');
				jobForm.find("[name='page']").val(page);
				jobForm.find("[name='perPageNum']").val(
						$('select[name="perPageNum"]').val());
				jobForm.find("[name='searchType']").val(
						$('select[name="searchType"]').val());
				jobForm.find("[name='keyword']").val(
						$('div.input-group>input[name="keyword"]').val());
				jobForm.attr({
					action : url,
					method : 'get'
				}).submit();
	}
   </script>   
   
   <script>
   function deleteCart(){
	   var cob_check = document.querySelectorAll('input[name="checkedValue"]:checked').length;
	   console.log(cob_check);
	
	   if(cob_check == 0) {
		      alert('선택된 도서가 없습니다')
		      return false;
		  }
	   
	   $("form[role='checkForm']").submit();
   }
	   
   </script>
   
   <script>
   function checkBoxAll(){
		var chks = document.getElementsByName("checkedValue");
		for(var i = 0; i < chks.length; i++){
			chks[i].checked = true;
		}
	}
	   
   </script>   
   
   
   <script>
   function rezSite(){
	   
	   
   }
   
   
   </script>