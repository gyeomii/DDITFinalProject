package bookred.member.controller;

import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;

import bookred.book.command.BookCriteria;
import bookred.book.dto.BookVO;
import bookred.book.service.BookService;
import bookred.member.dto.CartVO;
import bookred.member.service.CartService;

@Controller
@RequestMapping("/main/myInfo")
public class MemberCartController {
	
	@Autowired
	private CartService cartService;
	
	@Autowired
	private BookService bookService;
	
	@RequestMapping("/bookCart")
	public ModelAndView bookCart(BookCriteria cri,ModelAndView mnv, String mem_id)throws Exception{
		String url="/member/myInfo/cart/bookCart";
		
		mem_id = "aa";
//		cri.setPerPageNum(10);
		Map<String,Object> dataMap = cartService.getCartList(cri, mem_id);
		
		mnv.addObject("dataMap", dataMap);
		mnv.setViewName(url);
		
		return mnv;
	}	
	
	/*
	@RequestMapping("/bookCart/delete")
	public ModelAndView delete(ModelAndView mnv,@RequestParam List<String>checkedValue )throws Exception{
		String url="redirect:/main/myInfo/bookCart.do";
		
		
		String mem_id = "aa";

		CartVO cart = new CartVO();
		cart.setMem_id(mem_id);
		int count = 0;
		
		
		 for (String book_no : checkedValue) {
			 	System.out.println(book_no);
			    cart.setBook_isbn(Integer.parseInt(book_isbn));
			 	cartService.deleteCart(cart);
	            count ++;
	        }
		 System.out.println(count);
		 
		mnv.setViewName(url);
		 
		return mnv;
		
	}	
	*/
	
	@PostMapping(value="/insertCart")
	@ResponseBody
	public String insertCart(BookVO book)throws Exception{
		
		System.out.println("왔나");
		String mem_id = "aa";
		
		CartVO cart = new CartVO();
		cart.setMem_id(mem_id);
		cart.setBook_isbn(book.getBook_isbn());
		cartService.insertCart(cart);
		
		System.out.println("추가완료");
		
		return "success";
		
	}		
	
	
	@PostMapping(value="/checkCart")
	@ResponseBody
	public String checkCart(CartVO cart)throws Exception{
		String checkResult = "";
		String mem_id = "aa";
		cart.setMem_id(mem_id);		
		System.out.println("카트" + cart.getBook_isbn());
		System.out.println("카트" + cart.getMem_id());

		
		List<CartVO> cartList = cartService.checkCart(cart);
		System.out.println(cartList);
		
		if (!cartList.isEmpty()) {
			checkResult = "DUPLICATED";
		} else if (cartList != null) { checkResult = "널";}
		
		System.out.println(checkResult);
		return checkResult;
		
	}	
	
	
	@RequestMapping("/rezSite")
	public String rezSite()throws Exception{
		String url="/member/myInfo/cart/rezSite";
		return url;
	}
	
	@RequestMapping("/rezDrive")
	public String rezDrive()throws Exception{
		String url="/member/myInfo/cart/rezDrive";
		return url;
	}	


	
}
