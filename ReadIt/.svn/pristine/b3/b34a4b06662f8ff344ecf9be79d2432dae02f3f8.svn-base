package bookred.member.controller;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import bookred.member.command.MemberModifyCommand;
import bookred.member.dto.MemberVO;
import bookred.member.service.MemberService;

@Controller
@RequestMapping("/main/myInfo")
public class MemberController {

	@Autowired
	private MemberService memberService;

	public void SetSearchMemberService(MemberService memberService) {
		this.memberService = memberService;
	}
	

	@RequestMapping("/mySmartLib")
	public String smart() throws Exception {
		String url = "/member/myInfo/mySmartLib";
		return url;
	}

	@RequestMapping("/myPage")
	public String myPage() throws Exception {

		String url = "/member/myInfo/myPage";

		return url;
	}

	@RequestMapping(value = "/myPageForm", method = RequestMethod.POST)
	public String myPageModify(MemberModifyCommand modifyReq, HttpServletRequest request, RedirectAttributes rttr)
			throws Exception {

		String url = "redirect:/main/myInfo/myPage.do";
		System.out.println(modifyReq);
		
		  MemberVO member = modifyReq.toMemberVO();
		  
		  System.out.println("이메일 " + member.getMem_email());
		  System.out.println("이름" + member.getMem_name());
		  System.out.println("비번" + member.getMem_pwd());
		  System.out.println("번호" + member.getMem_phone());
		  System.out.println("주소" + member.getMem_addr());
		  System.out.println("관삼서" + member.getMem_interest());
		  System.out.println("mbti" + member.getMem_mbti());
		  System.out.println("차" + member.getMem_car());
		  try { 
			  memberService.modify(member); 
		  } catch (Exception e) {
			  rttr.addFlashAttribute("status", "fail");
			  System.out.println("실패");
		  } 
		  rttr.addFlashAttribute("status", "modify");
		  System.out.println("성공");
		 
		return url;
	}

	@RequestMapping("/volunteer")
	public String volunteer() throws Exception {
		String url = "/member/myInfo/volunteer";
		return url;
	}

	@RequestMapping("/event")
	public String event() throws Exception {
		String url = "/member/myInfo/event";
		return url;
	}

	@RequestMapping("/qna")
	public String qna() throws Exception {
		String url = "/member/myInfo/QNA";
		return url;
	}

	@RequestMapping("/facility")
	public String facility() throws Exception {
		String url = "/member/myInfo/facility";
		return url;
	}

}
