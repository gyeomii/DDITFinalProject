<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0,minimal-ui">
    <meta name="description" content="Vuexy admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Vuexy admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <link rel="apple-touch-icon" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/images/ico/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500;1,600" rel="stylesheet">

    <!-- BEGIN: Vendor CSS-->
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/charts/apexcharts.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/extensions/toastr.min.css">
    <!-- END: Vendor CSS-->

    <!-- BEGIN: Theme CSS-->
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/bootstrap-extended.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/colors.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/components.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/dark-layout.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/bordered-layout.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/semi-dark-layout.css">

    <!-- BEGIN: Page CSS-->
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/core/menu/menu-types/horizontal-menu.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/pages/dashboard-ecommerce.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/plugins/charts/chart-apex.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/plugins/extensions/ext-component-toastr.css">
    <!-- END: Page CSS-->

    <!-- BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/assets/css/style.css">
    <!-- END: Custom CSS-->
	<script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.js"></script>
</head>
<!-- END: Head-->

<!-- BEGIN: Body-->

<body class="horizontal-layout horizontal-menu  navbar-floating footer-static  " data-open="hover" data-menu="horizontal-menu" data-col="">
<%-- 	<c:set var="path" value="${pageContext.request.contextPath}"/> --%>
    <!-- BEGIN: Content-->
            <div class="content-body" style="padding: 20px;">
                <!-- Dashboard Ecommerce Starts -->
                <section id="dashboard-ecommerce">
                    <div class="row match-height">
                   <!-- Revenue Report Card -->
                        <div class="col-lg-8 col-12">
                            <div class="card card-revenue-budget">
                                <div class="row mx-0">
                                    <div class="col-md-12 col-12 revenue-report-wrapper">
                                        <div style="text-align: center;">
										   <div><img src="" id="preview"></div>
                                           <form action="" id="myForm" enctype="multipart/form-data" >
										        <input type="file" name="file"  id="myFile" value="">										       
										   </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/ Revenue Report Card -->
                    
                        <div class="col-lg-4 col-12">
                            <div class="row match-height">
                                <!-- Bar Chart - Orders -->
                                    <div class="card">
                                        <div class="card-body pb-50">
                                            <h3>차량번호</h3>
                                         <div class="avatar bg-light-primary me-1">
                                    	  </div>
                                            <input type="text" id="carNuminput" value=""> 
                                            <div id="statistics-order-chart"></div>
                                        </div>
                                    </div>
                                <!--/ Bar Chart - Orders -->


                    		   <!-- Bar Chart - Orders -->
                                    <div class="card">
                                    <div class="row">
                                      <div class="col-md-6 col-sm-6 col-12 mb-2 mb-md-0">
                            	 <div class="demo-inline-spacing">
                                        <button type="button" class="btn btn-warning" onclick="goAI();">
                                            <i data-feather="star" class="me-25"></i>
                                            <span>번호확인</span>
                                        </button>
                                        <button type="button" class="btn btn-outline-primary" disabled>
                                            <i data-feather="home" class="me-25"></i>
                                            <span>Home</span>
                                        </button>
                                    </div>
                                        </div>
                                        
                                        <div class="col-md-6 col-sm-6 col-12 mb-2 mb-md-0">
 											<div class="card text-center">
				                                <div class="card-body">
				                                    <div class="avatar bg-light-info p-50 mb-1">
				                                        <div class="avatar-content">
				                                            <i data-feather="eye" class="font-medium-5"></i>
				                                        </div>
				                                    </div>
				                                    <h4 class="fw-bolder" id="checkRez">예약확인</h4>
				                                </div>
				                            </div>
                                        </div>
                                       </div>
                                    </div>
                                <!--/ Bar Chart - Orders -->
                            </div>
                        </div>


                    </div>

                    <div class="row match-height">
                    
                    <!-- Developer Meetup Card -->
                        <div class="col-lg-3 col-md-6 col-12">
                            <div class="card card-developer-meetup">
                                <div class="card-body">
                                    <div class="mt-0">
                                        <div class="more-info">
                                        <h4 class="card-title mb-25">회원정보</h4>
                                        <label class="col-form-label" for="first-name">회원아이디</label>
                                        <input type="text" id="mem_id" class="form-control" name="contact" readonly >
                                        <label class="col-form-label" for="first-name">회원명</label>
                                        <input type="text" id="mem_name" class="form-control" name="contact" readonly >
                                        <label class="col-form-label" for="first-name">등급</label>
                                        <input type="text" id="mem_grade" class="form-control" name="contact" readonly >    
                                        <label class="col-form-label" for="first-name">전화번호</label>
                                        <input type="text" id="mem_call" class="form-control" name="contact" readonly >                                          
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/ Developer Meetup Card -->
                        <!-- Company Table Card -->
                        <div class="col-lg-9 col-12">
                            <div class="card card-company-table">
                                <div class="card-body p-0">
                                <div id="book_info" class="ag-theme-alpine" style="height:350px"></div>
<!--                                     <div class="table-responsive"> -->
<!--                                         <table class="table"> -->
<!--                                             <thead> -->
<!--                                                 <tr> -->
<!--                                                     <th>도서번호</th> -->
<!--                                                     <th>도서명</th> -->
<!--                                                     <th>저자</th> -->
<!--                                                     <th>출판사</th> -->
<!--                                                     <th>신청일</th> -->
<!--                                                     <th>방문일</th> -->
<!--                                                 </tr> -->
<!--                                             </thead> -->
<!--                                             <tbody> -->
<!--                                                 <tr> -->
<!--                                                     <td> -->
<!--                                                         <div class="d-flex align-items-center"> -->
<!--                                                             <div class="avatar rounded"> -->
<!--                                                                 <div class="avatar-content"> -->
<%--                                                                     <img src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/images/icons/book.svg" alt="Toolbar svg" /> --%>
<!--                                                                 </div> -->
<!--                                                             </div> -->
<!--                                                             <div> -->
<!--                                                                 <div class="fw-bolder">Dixons</div> -->
<!--                                                             </div> -->
<!--                                                         </div> -->
<!--                                                     </td> -->
<!--                                                     <td>$891.2</td> -->
<!--                                                     <td>$891.2</td> -->
<!--                                                     <td>$891.2</td> -->
<!--                                                     <td>$891.2</td> -->
<!--                                                     <td>$891.2</td> -->
<!--                                                 </tr> -->
<!--                                             </tbody> -->
<!--                                         </table> -->
<!--                                     </div> -->
                                </div>
                            </div>
                        </div>
                        <!--/ Company Table Card -->
					</div>
                </section>
                <!-- Dashboard Ecommerce ends -->
            </div>
    <!-- END: Content-->

    <div class="sidenav-overlay"></div>
    <div class="drag-target"></div>
    <!-- BEGIN: Vendor JS-->
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/vendors.min.js"></script>
    <!-- BEGIN Vendor JS-->

    <!-- BEGIN: Page Vendor JS-->
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/ui/jquery.sticky.js"></script>
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/charts/apexcharts.min.js"></script>
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/extensions/toastr.min.js"></script>
    <!-- END: Page Vendor JS-->

    <!-- BEGIN: Theme JS-->
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/core/app-menu.js"></script>
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/core/app.js"></script>
    <!-- END: Theme JS-->

    <!-- BEGIN: Page JS-->
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/scripts/pages/dashboard-ecommerce.js"></script>
    <!-- END: Page JS-->

    <script>
        $(window).on('load', function() {
            if (feather) {
                feather.replace({
                    width: 14,
                    height: 14
                });
            }
        })
    </script>
    
    <script>
    const cfile = document.querySelector("#myFile");
    const cmyForm = document.querySelector("#myForm");
    cfile.onchange = function(){
    	console.log(cfile.files);
    	let oneFile = cfile.files[0];
    	let fileReader = new FileReader();
    	fileReader.readAsDataURL(oneFile);
    	fileReader.onload = function(){
//     		console.log(fileReader.result);
            let carImg = document.getElementById("preview");
    		carImg.height = 250;
    		carImg.src = fileReader.result;
    		goAI();
    	}
    }
    </script>
    
    <script>
    function goAI(){
    	let formData = new FormData(cmyForm);
    	$.ajax({
    	type : 'post',
    	url : 'http://127.0.0.1:5000',
    	data : formData,
    	contentType: false,
        processData:false,
    	success : function(res){
    		document.getElementById("carNuminput").value = res;
    		}
    	});
    }
    </script>
    
    <script>
    var checkRez = document.querySelector("#checkRez");
    checkRez.addEventListener("click",memInfo );
    
    function memInfo(){
    	var dt_car_no = document.getElementById("carNuminput").value;
    	$.ajax({
        	type : 'get',
        	url : "${webPath}/admin/driveThrough/checkCar.do",
        	data : {dt_car_no:dt_car_no},
        	success : function(rmList){
        				console.log(rmList.length);
	         			if(rmList.length > 1) {
	         				alert("2개이상 조회될땐 하나를 선택하도록");
	         				//rmList 중 1 선택. 
	         				return false;
	         			} else if (rmList.length == 0) {
	         				alert("차량번호로 조회된 예약내역이 없습니다");
	         				return false;
						} 
	         			getMEMandBookinfo(rmList);
        			},
        	error:function(error){
       			alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
    		    }
        	});
    }
    
    </script>
    <script>
   function getMEMandBookinfo(rmList){
	   $.ajax({
        	type : 'post',
        	url : "${webPath}/admin/driveThrough/memAndRezBookList.do",
        	data : JSON.stringify(rmList[0]),
        	contentType : "application/json;charset=utf-8",
        	dataType: "JSON",
        	success : function(dataMap){
        		console.log(dataMap);
				var memberInfo = dataMap.member;
				var mem_gradeName;
				console.log(memberInfo);
				document.getElementById("mem_id").value = memberInfo.mem_id;
				document.getElementById("mem_name").value = memberInfo.mem_name;
				document.getElementById("mem_call").value = memberInfo.mem_phone;
				if(memberInfo.mem_rank == 1){mem_gradeName="알"} 				
				if(memberInfo.mem_rank == 2){mem_gradeName="책벌레"} 				
				if(memberInfo.mem_rank == 3){mem_gradeName="책책박사"} 				
				document.getElementById("mem_grade").value = mem_gradeName;
				
				
        		},
        		
   		error:function(error){
   			alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	    }
        	});
   }
    </script>
    <script>
    const book_columnDefs = [
    	  {headerName:"도서번호",field: "book_no", width:115},
    	  {headerName:"도서명",field: "book_title",  width:200},
    	  {headerName:"저자",field: "book_author",  width:100},
    	  {headerName:"출판사",field: "book_publisher",  width:100},
    	  {headerName:"신청일",field: "rm_date",  width:110},
    	  {headerName:"방문일",field: "want_date",  width:110}
    	];
    const book_rowData = [
  		  { book_no: "", book_title: "", book_author: "",book_publisher:"", rm_date:"", want_date:""}
  		];
  	
	const book_gridOptions = {
	  	 columnDefs: book_columnDefs,
	  	 rowData: book_rowData,
	  	 defaultColDef: {  // 모든 컬럼에 공통으로 주는 옵션 설정
	  	   sortable:true,
	  	   filter:false,
	  	   resizable:false,
	  	   editable:false,
	  	 },
	  	 pagination:false,
	  	 //paginationAutoPageSize:true,
	  	 paginationPageSize:2,  //위 AutoPageSize랑 배타적
	  };
	
	  document.addEventListener('DOMContentLoaded', () => {
	      const book_gridDiv = document.querySelector('#book_info');
	      new agGrid.Grid(book_gridDiv, book_gridOptions);
	  });
    </script>
    
    <script>
   
//     var book_data = { book_no : ag_book_no, book_title: ag_book_title, book_author :ag_book_author, book_publisher: ag_book_publisher,
//     		rm_date : rm_date, want_date: want_date}
//     book_gridOptions.api.setRowData(book_data);
    </script>
</body>
<!-- END: Body-->

</html>