package bookred.admin.controller;

import java.awt.Stroke;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import bookred.admin.command.Criteria;
import bookred.admin.dto.EtcManageVO;
import bookred.admin.service.EtcManageService;
import bookred.book.command.BookCriteria;
import bookred.book.dto.BookVO;
import bookred.book.service.BookService;
import bookred.common.dto.MenuVO;
import bookred.common.service.MenuService;

@Controller
@RequestMapping("/admin/bookManage")
public class BookManageController {
	
	@Autowired
	private BookService bookService;
	
	@Autowired
	private EtcManageService etcManageService;

	@RequestMapping("/status")
	public String Status() throws Exception{
		String url = "admin/book/classification/staus";
		
		return url;
	}

	@RequestMapping("/big")
	public ModelAndView big(BookCriteria cri, ModelAndView mnv) throws Exception{
		String url = "admin/book/classification/big";
		System.out.println(cri.getPerPageNum());
		
		cri.setPerPageNum(10);
		Map<String,Object> dataMap = bookService.getAllBookList(cri);
		
		mnv.addObject("dataMap", dataMap);
		mnv.setViewName(url);
		
		
		return mnv;
	}
	
	@RequestMapping("/best")
	public String best() throws Exception{
		String url = "admin/book/recommend/best";
		
		return url;
	}	
	
	@RequestMapping("/recommend")
	public String recommend() throws Exception{
		String url = "admin/book/recommend/recommend";
		return url;
	}	
	
	@RequestMapping("/exRecommend")
	public String exRecommend() throws Exception{
		String url = "admin/book/recommend/exRecommend";
		return url;
	}	
	
	@RequestMapping("/rent")
	public String reservation() throws Exception{
		String url = "admin/book/rentAndReturn/rent";
		
		return url;
	}		
	
	@RequestMapping("/return")
	public String return2() throws Exception{
		String url = "admin/book/rentAndReturn/return";
		
		return url;
	}	
	
	@RequestMapping("/location")
	public String loacation() throws Exception{
		String url = "admin/book/location/location";
		
		return url;
	}	
	
	@RequestMapping("/locationCode")
	public String locationCode() throws Exception{
		String url = "admin/book/location/locationCode";
		
		return url;
	}	
	
	
	@RequestMapping("/stupid")
	public String stupidBook() throws Exception{
		String url = "admin/book/stupid/stupidBookStatus";
		
		return url;
	}		
	
	@RequestMapping("/stupidBookDone")
	public String stupidBookDone() throws Exception{
		String url = "admin/book/stupid/stupidBookDone";
		
		return url;
	}		
		
//	기타관리 Start
	@RequestMapping("/donation")
	public String donation() throws Exception{
		String url = "admin/book/etc/donation";
		
		return url;
	}	
	
	@RequestMapping("/noRent")
	public ModelAndView noRent(BookCriteria cri, ModelAndView mnv) throws Exception{
		String url = "admin/book/etc/noRent";
		
//		cri.setPerPageNum(10);
		Map<String,Object> dataMap = etcManageService.getAllNoRentList(cri);
		
		
		mnv.addObject("dataMap", dataMap);
		mnv.setViewName(url);
		
		return mnv;
	}		
	
	@RequestMapping("/registNoRentBook")
	public String registForm() {
		String url = "admin/book/etc/registNoRentBook";
		
		return url;
	}
	
	@RequestMapping("/regist")
	public String regist(EtcManageVO noRentBook, Model model, RedirectAttributes rttr ) throws Exception{
		String url="redirect:/admin/book/etc/registNoRentBook.do";
		
		System.out.println("등록된제목" +noRentBook.getBook_title());
		System.out.println("등록된상태코드" +noRentBook.getState_code());
		
//		미완성
		etcManageService.regist(noRentBook);
		
		rttr.addFlashAttribute("from", "regist");
		
		return url;
	}
	
	@RequestMapping(value = "/searchBook", method = RequestMethod.GET, produces = "application/json;charset=utf-8")
	@ResponseBody
	public List<BookVO> searchBook(String book_isbn, Model model) throws Exception {
		List<BookVO> dataList = bookService.selectBookByBookIsbn(book_isbn);
		for (BookVO bookVO : dataList) {
			System.out.println(bookVO.getBook_isbn());
			System.out.println(bookVO.getBook_title());
			System.out.println(bookVO.getBook_publisher());
		}
		
		return dataList;
	}
	
	@RequestMapping("/lossBook")
	public ModelAndView lossBook(BookCriteria cri, ModelAndView mnv) throws Exception{
		String url = "admin/book/etc/lossBook";
		
		cri.setPerPageNum(10);
		Map<String, Object> dataMap = etcManageService.getLossBookList(cri);
		
		mnv.addObject("dataMap", dataMap);
		mnv.setViewName(url);
		
		return mnv;
	}		
	
	@RequestMapping("/getBook")
	public String getBook() throws Exception{
		String url = "admin/book/etc/getBook";
		
		return url;
	}		

	@RequestMapping("/registBook")
	public String registBook() throws Exception{
		String url = "admin/book/etc/registBook";
		
		return url;
	}		
	
}
