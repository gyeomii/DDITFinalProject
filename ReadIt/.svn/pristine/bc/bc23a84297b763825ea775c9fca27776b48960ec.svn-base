<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!DOCTYPE html>
<html class="loading"  data-textdirection="ltr">
<!-- BEGIN: Head-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0,minimal-ui">
    <meta name="description" content="Vuexy admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Vuexy admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <link rel="apple-touch-icon" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/images/ico/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500;1,600" rel="stylesheet">

    <!-- BEGIN: Vendor CSS-->
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/charts/apexcharts.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/css/extensions/toastr.min.css">
    <!-- END: Vendor CSS-->

    <!-- BEGIN: Theme CSS-->
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/bootstrap-extended.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/colors.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/components.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/dark-layout.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/bordered-layout.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/themes/semi-dark-layout.css">

    <!-- BEGIN: Page CSS-->
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/core/menu/menu-types/horizontal-menu.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/pages/dashboard-ecommerce.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/plugins/charts/chart-apex.css">
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/css/plugins/extensions/ext-component-toastr.css">
    <!-- END: Page CSS-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

    <!-- BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/assets/css/style.css">
    <!-- END: Custom CSS-->
	<script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.js"></script>
</head>
<!-- END: Head-->
<style>
.input-file-button{
  padding: 6px 25px;
  background-color:#FF6600;
  border-radius: 4px;
  color: white;
  cursor: pointer;
}
.form-control{
  height: 30px;
}
#carNuminput{
	margin-bottom: 10px; 
	height: 65px;
	width: 148px; 
	padding: 10px; 
	font-size: 20px; 
	text-align: center;
	border: 2px solid #be98e9;
	border-radius: 7px;
	background-color: #e1ebff;
}

</style>
<!-- BEGIN: Body-->

<body class="horizontal-layout horizontal-menu  navbar-floating footer-static  " data-open="hover" data-menu="horizontal-menu" data-col="">
<%-- 	<c:set var="path" value="${pageContext.request.contextPath}"/> --%>
    <!-- BEGIN: Content-->
            <div class="content-body" style="padding: 20px; font-family: 'Noto Sans KR', sans-serif;">
                <!-- Dashboard Ecommerce Starts -->
                <section id="dashboard-ecommerce">
                  <div class="row match-height" style="padding-right: 15px;">
                   <!-- Revenue Report Card -->
                        <div class="col-lg-8 col-12">
                            <div class="card card-revenue-budget">
                                <div class="row mx-0">
                                    <div class="col-md-12 col-12 revenue-report-wrapper">
                                        <h4 class="card-title mb-25" style="padding-bottom: 20px;">차량 확인</h4>
                                        <div class="row" style="text-align: center;">
										   <div class="col-md-8" >
	                                           <label for="myFile">
											   <img src="${webPath}/resources/img/car2.jpg" id="preview" height="280px;">
												</label>
											</div>
											<div class="col-md-4">
											 <div class="card-body " style="padding: 0px;">
	                                            <img src="${webPath}/resources/img/aicar.jpg" height="100px;">
	                                            <input type="text" id="carNuminput" value=""> 
	                                         </div>
	                                         <div>
	                                         	<button type="button" id="checkRez" style="border: none; padding: 0px;">
	                                         <img src="${webPath}/resources/img/ch.jpg" id="preview" height="95px;" >
	                                         	</button>
	                                         </div>
	                                         <div>
<!-- 	                                         	<button type="button"  style="border: none; padding: 0px;"> -->
<%-- 	                                         <img src="${webPath}/resources/img/ch.jpg" id="" height="45px;" > --%>
<!-- 	                                         	</button> -->
	                                         </div>
											</div>
                                           <form action="" id="myForm" enctype="multipart/form-data" >
										        <input type="file" name="file"  id="myFile" value=""  style="display: none;">										       
										   </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--/ Revenue Report Card -->
                    
                        <div class="col-lg-4 col-12">
                            <div class="row match-height">
                                <!-- Bar Chart - Orders -->
                                    <div class="card" style="height: 370px; ">
                                          <div class="mt-0">
                                        <div class="more-info" style="padding: 20px;">
                                        <h4 class="card-title mb-25" style="padding-bottom: 20px;">회원정보</h4>
                                        <label class="col-form-label" for="first-name">회원아이디</label>
                                        <input type="text" id="mem_id" class="form-control" name="contact" readonly >
                                        <label class="col-form-label" for="first-name">회원명</label>
                                        <input type="text" id="mem_name" class="form-control" name="contact" readonly >
                                        <label class="col-form-label" for="first-name">등급</label>
                                        <input type="text" id="mem_grade" class="form-control" name="contact" readonly >    
                                        <label class="col-form-label" for="first-name">전화번호</label>
                                        <input type="text" id="mem_call" class="form-control" name="contact" readonly >                                          
                                        </div>
                                    </div>
                                    </div>
                                <!--/ Bar Chart - Orders -->

                            </div>
                        </div>


                    </div>

                    <div class="row match-height">
                    <!-- Developer Meetup Card -->
                        <!--/ Developer Meetup Card -->
                        <div class="col-lg-12 col-12">
                            <div class="card card-company-table">
                            <div class="more-info" style="padding: 20px;">
                                <div class="card-body p-0">
                                 <h4 class="card-title mb-25" style="padding-bottom: 20px;">도서정보</h4>
                                <div id="book_info" class="ag-theme-alpine" style="height:250px"></div>
                                </div>
                                </div>
                            </div>
                        </div>
					</div>
                </section>
                <div style="position: relative;"></div>
                <div style="float: right;">
					<button type="reset" class="btn btn-primary " id="bookRent" onclick="bookRent()">대출하기</button>
					<button type="reset" class="btn btn-danger " id="" onclick="closeClick()">창 닫기</button>
                </div>
                <!-- Dashboard Ecommerce ends -->
            </div>
    <!-- END: Content-->

    <!-- BEGIN: Vendor JS-->
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/vendors.min.js"></script>
    <!-- BEGIN Vendor JS-->

    <!-- BEGIN: Page Vendor JS-->
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/ui/jquery.sticky.js"></script>
<%--     <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/vendors/js/extensions/toastr.min.js"></script> --%>
    <!-- END: Page Vendor JS-->

    <!-- BEGIN: Theme JS-->
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/core/app-menu.js"></script>
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/core/app.js"></script>
    <!-- END: Theme JS-->

    <!-- BEGIN: Page JS-->
    <script src="${webPath}/resources/vuexy/html-version/Bootstrap5/vuexy-html-bootstrap5-admin-template/app-assets/js/scripts/pages/dashboard-ecommerce.js"></script>
    <!-- END: Page JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <%@ include file="../../../common/index_js.jsp"%>

    <script>
        $(window).on('load', function() {
            if (feather) {
                feather.replace({
                    width: 14,
                    height: 14
                });
            }
        })
    </script>
    
    <script>
    const cfile = document.querySelector("#myFile");
    const cmyForm = document.querySelector("#myForm");
    cfile.onchange = function(){
    	console.log(cfile.files);
    	let oneFile = cfile.files[0];
    	let fileReader = new FileReader();
    	fileReader.readAsDataURL(oneFile);
    	fileReader.onload = function(){
//     		console.log(fileReader.result);
            let carImg = document.getElementById("preview");
    		carImg.height = 280;
    		carImg.src = fileReader.result;
    		goAI();
    	}
    }
    </script>
    
    <script>
    function goAI(){
    	let formData = new FormData(cmyForm);
    	$.ajax({
    	type : 'post',
    	url : 'http://127.0.0.1:5000',
    	data : formData,
    	contentType: false,
        processData:false,
    	success : function(res){
    		document.getElementById("carNuminput").value = res;
    		},
   		error:function(error){
      		alert("AI연결오류/ 차량번호를 직접 입력하세요");
   		    }	
    	});
    }
    </script>
    
    <script>
    var checkRez = document.querySelector("#checkRez");
    checkRez.addEventListener("click",memInfo );
    
    function memInfo(){
    	var dt_car_no = document.getElementById("carNuminput").value;
    	$.ajax({
        	type : 'get',
        	url : "${webPath}/admin/driveThrough/checkCar.do",
        	data : {dt_car_no:dt_car_no},
        	success : function(rmList){
        				console.log(rmList.length);
	         			if(rmList.length > 1) {
	         				alert("2개이상 조회될땐 하나를 선택하도록");
	         				//rmList 중 1 선택. 
	         				return false;
	         			} else if (rmList.length == 0) {
	         				alert("차량번호로 조회된 예약내역이 없습니다");
	         				return false;
						} 
	         			getMEMandBookinfo(rmList);
        			},
        	error:function(error){
       			alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
    		    }
        	});
    }
    
    </script>
    <script>
	var bkList;
    
	function getMEMandBookinfo(rmList){
	   $.ajax({
        	type : 'post',
        	url : "${webPath}/admin/driveThrough/memAndRezBookList.do",
        	data : JSON.stringify(rmList[0]),
        	contentType : "application/json;charset=utf-8",
        	dataType: "JSON",
        	success : function(dataMap){
        		console.log(dataMap);
        		bkList = dataMap.bkList;
				var memberInfo = dataMap.member;
				var mem_gradeName;
				console.log(memberInfo);
				document.getElementById("mem_id").value = memberInfo.mem_id;
				document.getElementById("mem_name").value = memberInfo.mem_name;
				document.getElementById("mem_call").value = memberInfo.mem_phone;
				if(memberInfo.mem_rank == 1){mem_gradeName="알"} 				
				if(memberInfo.mem_rank == 2){mem_gradeName="책벌레"} 				
				if(memberInfo.mem_rank == 3){mem_gradeName="책책박사"} 				
				document.getElementById("mem_grade").value = mem_gradeName;
				
				var driveBookList = dataMap.driveBookList;
				console.log(driveBookList);
				
				for(var i= 0; i<driveBookList.length; i++){
					console.log(dataMap.driveBookList[0].rm_date);
					driveBookList[i].want_date = moment(driveBookList[i].want_date).format('YYYY-MM-DD');
					driveBookList[i].rm_date = moment(driveBookList[i].rm_date).format('YYYY-MM-DD');
				}
				console.log(driveBookList[0].rm_date);
				
				book_gridOptions.api.setRowData(dataMap.driveBookList);
        		},
        		
	   		error:function(error){
	   			alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
		    	}
	        });
	   }
	   
	function bookRent(){
// 		console.log(bkList);
		$.ajax({
			type : 'post',
        	url : "${webPath}/admin/driveThrough/driveRent.do",
        	data : JSON.stringify(bkList),
        	contentType : "application/json;charset=utf-8",
        	success : function(res){
        		alert(res);
        	},
        	error:function(error){
	   			alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
		    	}
		});
	}
   
    </script>
    <script>
    const book_columnDefs = [
    	  {headerName:"도서번호",field: "book_no", width:100, cellClass: 'alignCenter'},
    	  {headerName:"도서명",field: "book_title", width:400},
    	  {headerName:"저자",field: "book_author", width:150},
    	  {headerName:"출판사",field: "book_publisher", width:150, cellClass: 'alignCenter'},
    	  {headerName:"신청일",field: "rm_date", width:150, cellClass: 'alignCenter'},
    	  {headerName:"방문일",field: "want_date",width:150, cellClass: 'alignCenter'},
    	];
    const book_rowData = [
  		  { book_no: "", book_title: "", book_author: "",book_publisher:"", rm_date:"", want_date:""}
  		];
  	
	const book_gridOptions = {
	  	 columnDefs: book_columnDefs,
	  	 rowData: book_rowData,
	  	 defaultColDef: {  // 모든 컬럼에 공통으로 주는 옵션 설정
	  	   sortable:true,
	  	   filter:false,
	  	   resizable:false,
	  	   editable:false,
	  	 },
	  	 pagination:false,
	  	 //paginationAutoPageSize:true,
	  	 paginationPageSize:2,  //위 AutoPageSize랑 배타적
	  };
	
	  document.addEventListener('DOMContentLoaded', () => {
	      const book_gridDiv = document.querySelector('#book_info');
	      new agGrid.Grid(book_gridDiv, book_gridOptions);
	  });
    </script>
    <script>

    </script>
    <script>
	function closeClick(){
		window.close();
	}
</script>




</body>
<!-- END: Body-->

</html>