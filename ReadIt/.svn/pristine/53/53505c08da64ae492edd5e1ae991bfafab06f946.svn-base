package bookred.main.controller;

import java.sql.SQLException;
import java.util.Date;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import bookred.book.controller.bookController;
import bookred.main.dto.MultiOneVO;
import bookred.main.service.MultiOneService;
import bookred.member.dto.MemberVO;
import bookred.member.service.MemberService;
import oracle.jdbc.proxy.annotation.Post;

@Controller
@RequestMapping("/main/facilitySpace")
public class FacilitySpaceController {

	@Autowired
	private MultiOneService MultiOneService;
	@Autowired
	private MemberService memberService;

	@RequestMapping("/studyRoom")
	public String studyRoomList() {
		String url = "main/facility/studyRoom";

		return url;
	}

	
	
	
	//멀티 미디어실
	
	@RequestMapping("/multiRoom")
	public String multiRoomList(String WinTitle) {
		String url = "main/facility/multiRoom";

		return url;
	}

	@RequestMapping("/multiOneDetail")
	public String multiDetail1() {
		String url = "main/facility/multiOneDetail";

		return url;
	}

	@RequestMapping("/multiTwoDetail")
	public String multiTwoDetail() {
		String url = "main/facility/multiTwoDetail";

		return url;
	}

	@RequestMapping("/multiThreeDetail")
	public String multiThreeDetail() {
		String url = "main/facility/multiThreeDetail";

		return url;
	}

	@RequestMapping("/multiFourDetail")
	public String multiFourDetail() {
		String url = "main/facility/multiFourDetail";

		return url;
	}

	@PostMapping("regist")
	public String getDate(MultiOneVO multiOne, HttpServletRequest request, RedirectAttributes redirect)
			throws Exception {
		String url = "redirect:/main/facilitySpace/multiRoom.do";

		HttpSession session = request.getSession();
		MemberVO loginUser = (MemberVO) session.getAttribute("loginUser");
		multiOne.setMem_id(loginUser.getMem_id());

		String result = MultiOneService.insertMultiOne(multiOne);

		redirect.addFlashAttribute("result", result);
		
		return url;
	}

	@RequestMapping(value = "ajaxSeatData", method = RequestMethod.POST)
	@ResponseBody
	private List<String> ajaxSeatData(String seatDate, String seatTime,String fac_code) throws Exception {
		MultiOneVO multiOne = new MultiOneVO();
		multiOne.setFr_day(seatDate);
		multiOne.setFr_hour(Integer.parseInt(seatTime));
		multiOne.setFac_code(fac_code);
		
		List<String> dataList = MultiOneService.getSeatByDateAndTime(multiOne);
		return dataList;

	}
	

	
	
	
	
	
	
	
	
	
	
	
	
	//meetingRomm
	
	@RequestMapping("/meetingRoom")
	public String meetingRoom() {
	String url ="main/facility/meetingRoom";
	
	return url;
				
	}
	
	
	@RequestMapping("/meetingRoomOne")
	public String meetingRoomOne() {
		String url = "main/facility/meetingRoomOne";

		return url;
	}
	
	@RequestMapping("/meetingRoomTwo")
	public String meetingRoomTwo() {
		String url = "main/facility/meetingRoomTwo";

		return url;
	}

	@PostMapping("/meetingRegist")
	public String meetingRegist(MultiOneVO mutiOne, HttpServletRequest http, RedirectAttributes redirect)throws Exception{
		String url = "redirect:/main/facilitySpace/meetingRoom.do";

		HttpSession session = http.getSession();
		MemberVO loginUser = (MemberVO) session.getAttribute("loginUser");
		mutiOne.setMem_id(loginUser.getMem_id());
		
		
		
		String result = MultiOneService.regist(mutiOne);
		System.out.println(result);
		
		redirect.addFlashAttribute("result", result);
		
		return url;
	}
	
	@PostMapping(value = "/getAMeetingTime")
	@ResponseBody
	private Map<String, Object> getAMeetingTime(String day) throws Exception{
		Map<String, Object> dataMap = MultiOneService.getAMeetingTime(day);
		return dataMap;
	}
	
	@PostMapping(value = "/getBMeetingTime")
	@ResponseBody
	private Map<String, Object> getBMeetingTime(String day) throws Exception{
		Map<String, Object> dataMap = MultiOneService.getBMeetingTime(day);
		return dataMap;
	}
	
}
